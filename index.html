<!DOCTYPE html>
<html>
    <head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Mundiales</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="HandheldFriendly" content="true">
		
		<link rel="stylesheet" href="css/jquery.mobile-1.4.2.min.css" />
		<link rel="stylesheet" href="css/mundiales.min.css" />
		<link rel="stylesheet" href="css/flags.css" />
		
		<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
		<script type="text/javascript" src="js/jquery.mobile-1.4.2.min.js"></script>		
		<script type="text/javascript">
			var partidos = '';
			var apuestas = '';
			function flag(code){
					var codes = {};
					codes['ALG'] = 'dz';
					codes['ARG'] = 'ar';
					codes['AUS'] = 'au';
					codes['BEL'] = 'be';
					codes['BIH'] = 'ba';
					codes['BRA'] = 'br';
					codes['CHI'] = 'cl';
					codes['CIV'] = 'ci';
					codes['CMR'] = 'cm';
					codes['COL'] = 'co';
					codes['CRC'] = 'cr';
					codes['CRO'] = 'hr';
					codes['ECU'] = 'ec';
					codes['ENG'] = 'england';
					codes['ESP'] = 'es';
					codes['FRA'] = 'fr';
					codes['GER'] = 'de';
					codes['GHA'] = 'gh';
					codes['GRE'] = 'gr';
					codes['HON'] = 'hn';
					codes['IRN'] = 'ir';
					codes['ITA'] = 'it';
					codes['JPN'] = 'jp';
					codes['KOR'] = 'kr';
					codes['MEX'] = 'mx';
					codes['NED'] = 'nl';
					codes['NGA'] = 'ng';
					codes['POR'] = 'pt';
					codes['RUS'] = 'ru';
					codes['SUI'] = 'ch';
					codes['URU'] = 'uy';
					codes['USA'] = 'us';
					return codes[code];
			}
			$(function() {
				$( "#lstpartidos" ).html('<p align="center"><img src="css/images/ajax-loader.gif" /></p>');
				refresh();
		
			});	
			
			function refresh(){
				var urlApuestas = 'http://jsonblob.com/api/jsonBlob/53ad7745e4b07a1c9f44e5a6';
				$.getJSON(urlApuestas, function(data) {
					apuestas = data;
					alert(apuestas[5].nombre)
				});	

				var urlPartidos = 'http://worldcup.sfg.io/matches?by_date=ASC';
				$.getJSON(urlPartidos, function(data) {
					partidos = data;
					cargarPartidos();
				});	
			}
			
			function cargarPartidos(){
				if(partidos!= ''){
					$( "#lstpartidos" ).html('');
					var ultimaFecha = '';
					$.each(partidos, function(nro, partido) {
						var datetime = partido.datetime.split('T');
						var dia = datetime[0];
						var horamin = datetime[1].split('.')[0].split(':');
						var hora = horamin[0] + ':' + horamin[1];
						if(dia != ultimaFecha){
							$( "#lstpartidos" ).append($('<li data-role="list-divider" >'+dia+'</li>'));
							ultimaFecha = dia;
						}
						txt = '<small>'+hora+'</small>&nbsp;&nbsp;';
						txt += '<img src="img/blank.gif" class="flag flag-'+flag(partido.home_team.code)+'"> ';		
						txt += partido.home_team.code; //country;
						txt += (partido.status == 'completed')? (' <big>' + partido.home_team.goals + '</big> ') : '-';
						txt += ' : ';
						txt += (partido.status == 'completed')? (' <big>' + partido.away_team.goals + '</big> ') : '-';
						txt += partido.away_team.code; //.country;
						txt += ' <img src="img/blank.gif" class="flag flag-'+flag(partido.away_team.code)+'">';	
						
						$( "#lstpartidos" ).append($('<li><div>'+txt+'</div></li>'));
						$('#lstpartidos').trigger('create');    
						$('#lstpartidos').listview('refresh');
					});	
					
					partidos= '';
				}
			}
			
		</script>		
    </head>
    <body>
		<div data-role="page" id="inicio" >
			<div data-role="header">
				<h1>Mundiales</h1>
			</div>
			
			<ul data-role="listview" >
				<li><a href="#partidos" onclick="cargarPartidos()"> <img src="img/blank.gif"  class="flag flag-br ui-li-icon"/> Brasil 2014</a></li>
			</ul>
			<div data-role="footer" data-position="fixed" >
					<div data-role="navbar">
						<ul>
							<li><a href="#inicio" data-icon="home">Inicio</a></li>
							<li><a href="#partidos" data-icon="calendar" >Partidos</a></li>
							<li><a href="#partidos" data-icon="star">Llaves</a></li>
							<li><a href="#partidos" data-icon="bullets">Posiciones</a></li>
						</ul>
					</div><!-- /navbar -->
			</div><!-- /footer -->
		</div>



		<div data-role="page" id="partidos"â€³>
			<div data-role="header">
				<a data-role="button" data-rel="back" data-icon="left" class="ui-btn-left ui-alt-icon ui-nodisc-icon ui-btn ui-icon-carat-l ui-btn-icon-notext ui-corner-all"></a>
				<h1>Partidos</h1>
			</div>

			<ul id="lstpartidos" data-role="listview" data-filter="true">
			</ul>
			
			<div data-role="footer" data-position="fixed" >
					<div data-role="navbar">
						<ul>
							<li><a href="#inicio" data-icon="home" >Inicio</a></li>
							<li><a href="#partidos" data-icon="calendar" onclick="refresh()">Partidos</a></li>
							<li><a href="#partidos" data-icon="star">Llaves</a></li>
							<li><a href="#partidos" data-icon="bullets">Posiciones</a></li>
						</ul>
					</div><!-- /navbar -->
			</div><!-- /footer -->
		</div>
		
    </body>
</html>