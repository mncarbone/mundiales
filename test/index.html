<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>HTML5/CSS3 Mobile Web App - List View</title>
	<meta name="author" content="DZineBlog">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="HandheldFriendly" content="true">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<!-- APPLE TOUCH APP ICONS
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" href="apple-touch-icon-57x57.png">
	<link rel="shortcut icon" href="http://dzineblog.com/wp-content/themes/journalist/favicon.png">
	<link rel="icon" href="http://dzineblog.com/wp-content/themes/journalist/favicon.png">
	-->
	<!--
	<link rel="stylesheet" type="text/css" href="styles.css" media="all">
	<link rel="alternate stylesheet" type="text/css" href="responsive.css" media="all">
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	
<link rel="stylesheet" href="http://demos.jquerymobile.com/1.4.2/css/themes/default/jquery.mobile-1.4.2.min.css" />
	-->
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
	
	<script  type="text/javascript">

	function fetchJSONFile(path, callback) {
		var httpRequest = (window.XMLHttpRequest)? new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");
		httpRequest.onreadystatechange = function() {
			if (httpRequest.readyState === 4) {
				if (httpRequest.status === 200) {
					var data = JSON.parse(httpRequest.responseText);
					if (callback) callback(data);
				}
			}
		};
		httpRequest.open('GET', path);
		httpRequest.send(); 
	}
	

	function guardar(variable, dato){
		if(localStorage && localStorage.setItem){
			localStorage.setItem(variable, dato);
		}
	}
		
	function leer(variable, defval){
		if(localStorage && localStorage.getItem){
			return localStorage.getItem(variable);
		}
		return defval;
	}
	
	var partidos = leer('partidos',false);
	if(!partidos){
		fetchJSONFile("http://worldcup.sfg.io/matches?by_date=ASC", cargarPartidos);
	}
	else {
		partidos = JSON.parse(partidos);
		
	}
	
	function cargarPartidos(data){
		
		partidos = data;
		guardar('partidos',JSON.stringify(data));
		init();
	}
	
	function mostrarPartidos(){
		var lista = document.getElementById('nlists');
		var tot = partidos.length;
		var diaAnt = '';
		for(var i=0;i<tot;i++){
			partido = partidos[i];
			if(partido.match_number<=48){
				datetime = partido.datetime.split('T');
				dia = datetime[0];
				hora = datetime[1].split('.')[0];
				fecha = dia + ' ' + hora;
				if(dia != diaAnt){
					var item = document.createElement('li');
					item.innerHTML = fecha;
					item.className="head";
					item.dataset.role="list-divider"
					lista.appendChild(item);
				}
				diaAnt = dia;
			
				var item = document.createElement('li');
				var a = document.createElement('div');
				local = partido.home_team.country;
				cod_local = partido.home_team.code;
				gol_local = (partido.status == 'completed')? partido.home_team.goals : '-';
				bandera_local = '<img src="images/flags/'+flag(cod_local)+'.png">';
				
				visitante = partido.away_team.country;
				cod_visitante = partido.away_team.code;
				gol_visitante = (partido.status == 'completed')? partido.away_team.goals : '-';
				bandera_visitante = '<img src="images/flags/'+flag(cod_visitante)+'.png">';
				
				//a.href="http://google.com?output=search&q="+local+'+vs.+'+visitante;
				//a.target='blank';
				
				a.innerHTML = '<span>&nbsp;</span>'+bandera_local+' '+cod_local+' <big>'+gol_local+'</big> : <big>'+gol_visitante+'</big> '+cod_visitante+' '+bandera_visitante;
				if(partido.apuestas)
					a.innerHTML += '&nbsp;&nbsp; L:' + partido.apuestas['L'].length + ' | E:' + partido.apuestas['E'].length + ' | V:' +partido.apuestas['V'].length
				
				
				item.appendChild(a);
				lista.appendChild(item);
			}
		}
	}
	
	function init(){
		if(partidos){
			asignarApuestas()
			mostrarPartidos();
		}
	}
	
	function flag(code){
			var codes = {};
			codes['ALG'] = 'dz';
			codes['ARG'] = 'ar';
			codes['AUS'] = 'au';
			codes['BEL'] = 'be';
			codes['BIH'] = 'ba';
			codes['BRA'] = 'br';
			codes['CHI'] = 'cl';
			codes['CIV'] = 'ci';
			codes['CMR'] = 'cm';
			codes['COL'] = 'co';
			codes['CRC'] = 'cr';
			codes['CRO'] = 'hr';
			codes['ECU'] = 'ec';
			codes['ENG'] = 'england';
			codes['ESP'] = 'es';
			codes['FRA'] = 'fr';
			codes['GER'] = 'de';
			codes['GHA'] = 'gh';
			codes['GRE'] = 'gr';
			codes['HON'] = 'hn';
			codes['IRN'] = 'ir';
			codes['ITA'] = 'it';
			codes['JPN'] = 'jp';
			codes['KOR'] = 'kr';
			codes['MEX'] = 'mx';
			codes['NED'] = 'nl';
			codes['NGA'] = 'ng';
			codes['POR'] = 'pt';
			codes['RUS'] = 'ru';
			codes['SUI'] = 'ch';
			codes['URU'] = 'uy';
			codes['USA'] = 'us';
			return codes[code];
	}
	
	function nombre(code){
		var nombres = {};
		nombres['ARGENTINA'] = 'ar';
		nombres['BOLIVIA'] 	= 'bo';
		nombres['BRASIL']	= 'br';
		nombres['CHILE'] 	= 'cl';
		nombres['COLOMBIA'] 	= 'co';
		nombres['COSTA RICA']= 'cr';
		nombres['ECUADOR'] 	= 'ec';
		nombres['MEXICO'] 	= 'mx';
		nombres['PARAGUAY'] 	= 'py';
		nombres['PERU'] 		= 'pe';
		nombres['URUGUAY'] 	= 'uy';
		nombres['VENEZUELA'] = 've';
		nombres['CROACIA'] 	= 'hr';
		nombres['CAMERUN'] 	= 'cm';
		nombres['ESPAÑA'] 	= 'es';
		nombres['HOLANDA'] 	= 'nl';
		nombres['AUSTRALIA'] = 'au';
		nombres['GRECIA'] 	= 'gr';
		nombres['INGLATERRA']= 'england';
		nombres['COSTA DE MARFIL'] = 'ci';
		nombres['ITALIA'] 	= 'it';
		nombres['JAPON'] 	= 'jp';
		nombres['FRANCIA'] 	= 'fr';
		nombres['SUIZA'] 	= 'ch';
		nombres['HONDURAS'] 	= 'hn';
		nombres['BOSNIA-HERZEGOVINA'] = 'ba';
		nombres['ALEMANIA'] 	= 'de';
		nombres['PORTUGAL'] 	= 'pt';
		nombres['IRAN'] 		= 'ir';
		nombres['NIGERIA'] 	= 'ng';
		nombres['GHANA'] 	= 'gh';
		nombres['ESTADOS UNIDOS'] = 'us';
		nombres['BELGICA'] 	= 'be';
		nombres['ARGELIA'] 	= 'dz';
		nombres['RUSIA'] 	= 'ru';
		nombres['REPUBLICA DE COREA'] = 'kr';
		bandera = flag(code);
		for(n in nombres) {
			if(nombres[n] == bandera){
				return n;
			}
		}
		return code;
	}
	
	var apuestas = [
		{	
			participante:'Pepe',
			partidos:[
				{l:'ARGENTINA', v:'BOSNIA-HERZEGOVINA', r:'L'},
				{l:'ARGENTINA', v:'IRAN', r:'L'}
			]
		}
	];
	
	function asignarApuestas(){
		var tot = apuestas.length;
		for(var i=0;i<tot;i++){
			apuesta = apuestas[i];
			totApuestas = apuesta.partidos.length;
			for (var j=0;j<totApuestas;j++){
				apuestaPartido = apuesta.partidos[j]
				apuestaPartido.participante = apuesta.participante;
				setApuesta(apuestaPartido.l,apuestaPartido.v, apuestaPartido);
			}
		}
	}
	
	function setApuesta(l,v, apuesta){
		var tot = partidos.length;
		for(var i=0;i<tot;i++){
			partido = partidos[i];
			if(nombre(partido.home_team.code) == l && nombre(partido.away_team.code) == v){
				if(!partidos[i].apuestas){
					partidos[i].apuestas = {'L':[], 'V':[], 'E':[]};
				}
				partidos[i].apuestas[apuesta.r].push(apuesta);
			}
		}
	}
	$.mobile.defaultPageTransition='flip'

	</script>
</head>

<body onload="init()">

	<div data-role="page" id="inicio" >
		<div data-role="header">
			<h1>Mundiales</h1>
		</div>
		
		<ul data-role="listview" >
			<li><a href="#partidos">Brasil 2014</a></li>
		</ul>

	</div>



	<div data-role="page" id="partidos"″>
		<div data-role="header">
			<a data-role="button" data-rel="back" data-icon="left" class="ui-btn-left ui-alt-icon ui-nodisc-icon ui-btn ui-icon-carat-l ui-btn-icon-notext ui-corner-all"></a>
			<h1>Partidos</h1>
		</div>

		<ul id="nlists" data-role="listview" >

		</ul>
		
		<div data-role="footer" data-position="fixed" >
				<div data-role="navbar">
					<ul>
						<li><a href="#inicio" data-icon="home">Inicio</a></li>
						<li><a href="#partidos" data-icon="grid"  class="ui-btn-active">Partidos</a></li>
						<li><a href="#partidos" data-icon="gear">Llaves</a></li>
						<li><a href="#partidos" data-icon="gear">Posiciones</a></li>
					</ul>
				</div><!-- /navbar -->
		</div><!-- /footer -->
	</div>
	

	
</body>
</html>